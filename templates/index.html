<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Last Gallery</title>

  <!-- Main stylesheet -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-debug.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-tile-labels.css') }}">

  <!-- Cropper.js stylesheet -->
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/cropper/cropper.min.css') }}">

  <!-- Expose server state to JS (single source of truth) -->
  <script>
    window.SERVER_GRID_COLOR = "{{ grid_color|default('#b84c27') }}";
    window.GRID_SVG_URL = "{{ url_for('static', filename='grid_full.svg') }}";
    // DISABLED: No longer inject demo placement data
    // Tiles start empty - artwork only comes from upload system database
    window.SERVER_PLACEMENT = {};
  </script>

</head>

<body>
  <!-- Top bar: title (left) + controls (right) -->
  <header class="controls">
    <div id="siteTitle">The Last Gallery</div>

    <div id="gridControls" role="group" aria-label="Gallery controls">
      <!-- Primary action -->
      <button id="addArtworkBtn" type="button">Add Your Artwork</button>

      <!-- Hamburger menu wrapper (positioning context) -->
      <div class="hamburger-wrapper">
        <!-- Hamburger menu button -->
        <button id="hamburger-btn" aria-label="Menu" aria-expanded="false" aria-haspopup="true">
          <span class="hamburger-bar"></span>
          <span class="hamburger-bar"></span>
          <span class="hamburger-bar"></span>
        </button>

        <!-- Dropdown menu (hidden by default) -->
        <ul id="hamburger-menu" role="menu" aria-hidden="true">
          <li role="none">
            <button id="menu-item-edit" role="menuitem">Edit Your Artwork Submission</button>
          </li>
          <li role="none">
            <button id="menu-item-admin" role="menuitem">Admin</button>
          </li>
        </ul>
      </div>
    </div>
  </header>

  <div id="simpleWelcome" class="simpleWelcome hidden" role="dialog" aria-modal="true" aria-label="Welcome">
    <div class="simpleWelcomeCard" role="document">
      <div class="simpleWelcomeTitle">Welcome to The Last Gallery</div>
      <div class="simpleWelcomeSubtitle">A dynamic time capsule of creative works</div>
      <div class="welcome-content-row">
        <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="The Last Gallery" class="welcome-logo">
        <ul class="welcome-instructions">
          <li>Scroll to explore</li>
          <li class="touch-only">Pinch to zoom out</li>
          <li>Click images for full size</li>
        </ul>
      </div>
      <button id="simpleWelcomeEnterBtn" class="simpleWelcomeBtn" type="button">Enter</button>
    </div>
  </div>

  <!-- Grid Wrapper -->
  <div class="gallery-wall-wrapper">
    <div class="zoom-wrapper">
      <div id="galleryWall" class="gallery-wall"></div>
    </div>
  </div>

  <!-- Add Artwork modal (hidden by default) -->
  <div id="uploadModal" class="modalOverlay hidden" role="dialog" aria-modal="true" aria-labelledby="uploadModalTitle">
    <div class="modalCard" role="document">
      <h2 id="uploadModalTitle">Add Your Artwork</h2>

      <div class="upload-help">
        <p>Choose an image from your device. Supported formats: JPG, PNG.</p>
        <ul>
          <li><strong>Hint:</strong> You may upload images of any dimensions. For best results, images closer to square work best.</li>
          <li><strong>Hint:</strong> Use the cropping tool in the preview window below to select the best square portion of your image to fit the square gallery tile.<br>(Note: When the tile is clicked, your image will pop up full-size with no cropping.)</li>
        </ul>
      </div>

      <div class="upload-controls">
        <label for="uploadFile">Choose image</label>
        <input id="uploadFile" type="file" accept="image/png, image/jpeg">
      </div>

      <!-- Preview area -->
      <div class="previewBox" id="previewBox">
        <img id="previewImage" src="" alt="Preview" class="hidden">
      </div>

      <div class="upload-instructions">
        We will optimize your image to load faster in the gallery.
      </div>

      <div class="upload-actions">
        <button id="cancelUploadBtn" type="button">Cancel</button>
        <button id="uploadContinue" type="button" disabled>Continue</button>
      </div>
    </div>
  </div>

  <!-- Tier-2: Artwork Info Modal (overlays Tier-1 upload modal) -->
  <div id="metaModalOverlay" class="modal-overlay-tier2 hidden" aria-hidden="true">
    <div id="metaModal" class="modal-card-tier2" role="dialog" aria-modal="true">
      <div class="modal-header-tier2">
        <h2>Artwork Info</h2>
        <button id="metaCloseBtn" type="button" class="close-btn" aria-label="Close">×</button>
      </div>

      <div class="modal-body-tier2">
        <div id="metaRequiredError" class="required-error hidden">
          Artist Name and Artwork Title are required to submit.
        </div>

        <label for="metaArtistInput">Artist Name <span class="required-mark">*</span></label>
        <input id="metaArtistInput" type="text" maxlength="80" placeholder="Enter artist name" required />

        <label for="metaTitleInput">Artwork Title <span class="required-mark">*</span></label>
        <input id="metaTitleInput" type="text" maxlength="120" placeholder="Enter artwork title" required />

        <label for="metaYearInput">Year of Creation</label>
        <input id="metaYearInput" type="text" maxlength="10" placeholder="e.g., 2024" />

        <label for="metaMediumInput">Medium</label>
        <input id="metaMediumInput" type="text" maxlength="100" placeholder="e.g., oil on canvas, digital collage, acrylic on wood" />

        <label for="metaDimensionsInput">Dimensions</label>
        <input id="metaDimensionsInput" type="text" maxlength="50" placeholder="e.g., 16&quot;x20&quot;, 40cm x 50cm" />

        <label for="metaEditionInput">Edition Information</label>
        <input id="metaEditionInput" type="text" maxlength="80" placeholder="e.g., 1/10, Artist Proof, Open Edition (optional)" />

        <label class="checkbox-group-label">Artwork available for sale?</label>
        <div class="checkbox-group">
          <div class="checkbox-row">
            <label><input type="checkbox" id="metaForSaleYes" name="forSale" value="yes"> Yes</label>
            <label><input type="checkbox" id="metaForSaleNo" name="forSale" value="no"> No</label>
          </div>
          <div class="checkbox-row">
            <label><input type="checkbox" id="metaSaleOriginal" name="saleType" value="original"> Original</label>
            <label><input type="checkbox" id="metaSalePrint" name="saleType" value="print"> Print</label>
          </div>
        </div>

        <label class="contact-group-label">Email <span class="required-mark">*</span></label>
        <input id="metaContact1Input" type="email" maxlength="120" placeholder="e.g., artist@example.com" />
        <div id="metaContactError" class="required-error hidden" style="margin-top:8px; font-size:0.85rem;">
          A valid email address is required.
        </div>

        <label class="contact-group-label">Additional Contact (optional)</label>
        <div class="contact-type-radios">
          <label><input type="radio" name="contact2Type" value="email"> Email</label>
          <label><input type="radio" name="contact2Type" value="social"> Social Media</label>
          <label><input type="radio" name="contact2Type" value="website"> Website</label>
        </div>
        <input id="metaContact2Input" type="text" maxlength="120" placeholder="Select a contact type above" />

        <div id="metaError" class="error-text hidden"></div>
      </div>

      <div class="modal-actions-tier2">
        <button id="metaSkipBtn" type="button" class="secondary-btn">Return to Artwork Edit</button>
        <button id="metaContinueBtn" type="button" class="primary-btn">Continue</button>
      </div>
    </div>
  </div>

  <!-- Tier-3: Submission Confirmation Banner (overlays Tier-2 metadata modal) -->
  <div id="confirmBannerOverlay" class="confirm-banner-overlay hidden" aria-hidden="true">
    <div id="confirmBanner" class="confirm-banner" role="dialog" aria-modal="true">
      <h2 class="confirm-banner-heading">Important...</h2>
      <p class="confirm-banner-text">Know this: your creative work is about to become part of a finite collection—a living time capsule of creative expression that will endure for the life of the gallery. Once every tile is filled, submissions end forever. Because of this, edits are intentionally minimal: the artist and artwork text may be modified, but the image itself becomes preserved, not revisable. It's a rare opportunity to leave a definitive mark and take part in a closed constellation of art that can never be expanded, only experienced.</p>
      <div class="confirm-banner-actions">
        <button id="confirmCancelBtn" type="button" class="secondary-btn">Cancel</button>
        <button id="confirmSaveBtn" type="button" class="primary-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Edit Submission Banner (shown when user clicks "Edit Your Artwork Submission") -->
  <div id="editBannerOverlay" class="confirm-banner-overlay hidden" aria-hidden="true">
    <div id="editBanner" class="confirm-banner" role="dialog" aria-modal="true">
      <h2 class="confirm-banner-heading">A note about editing</h2>
      <p class="confirm-banner-text">Once submitted, artwork becomes a permanent part of The Last Gallery time capsule. However, if you need to correct artist or artwork related information, you're welcome to do that here.</p>
      <div class="confirm-banner-actions">
        <button id="editBannerCancelBtn" type="button" class="secondary-btn">Cancel</button>
        <button id="editBannerContinueBtn" type="button" class="primary-btn">Continue</button>
      </div>
    </div>
  </div>

  <!-- Admin modal (PIN gated) -->
  <div id="adminModal" class="modalOverlay hidden" role="dialog" aria-modal="true" aria-labelledby="adminModalTitle">
    <div class="modalCard" role="document">
      <h2 id="adminModalTitle">Admin</h2>

      <!-- PIN gate -->
      <div id="adminPinGate">
        <p class="modalSubtext">Enter PIN to unlock admin controls.</p>

        <div class="pinRow">
          <input
            id="adminPinInput"
            type="password"
            inputmode="numeric"
            autocomplete="one-time-code"
            maxlength="4"
            aria-label="Admin PIN"
          >
          <button id="adminPinSubmit" type="button">Unlock</button>
        </div>

        <div id="adminPinError" class="pinError hidden" aria-live="polite"></div>
      </div>

      <!-- Admin controls (hidden until unlocked) -->
      <div id="adminControlsPanel" class="hidden">
        <!-- Status message -->
        <div id="adminStatus" class="adminStatus hidden" role="status" aria-live="polite"></div>

        <div class="adminRow">
          <label for="gridColorPicker">Wall Color</label>
          <input
            type="color"
            id="gridColorPicker"
            value="{{ grid_color|default('#b84c27') }}"
          >
        </div>

        <div class="adminRow adminRow--spread">
          <label>
            <input type="checkbox" id="outlineToggle" checked>
            Show tile outlines
          </label>
          <label>
            <input type="checkbox" id="showTileLabelsToggle">
            Show Tile Labels
          </label>
        </div>

        <!-- Clear single tile -->
        <div class="adminSection">
          <h3>Clear Tile</h3>
          <div class="adminRow">
            <input
              type="text"
              id="adminClearTileIdInput"
              placeholder="Tile ID (e.g., X99)"
              maxlength="10"
            >
            <button id="clearTileBtn" type="button">Clear Tile</button>
          </div>
        </div>

        <!-- Move artwork -->
        <div class="adminSection">
          <h3>Move Artwork</h3>
          <div class="adminRow">
            <input
              type="text"
              id="adminMoveFromInput"
              placeholder="From: X99"
              maxlength="10"
            >
          </div>
          <div class="adminRow">
            <input
              type="text"
              id="adminMoveToInput"
              placeholder="To: X12"
              maxlength="10"
            >
          </div>
          <div class="adminRow">
            <button id="moveArtworkBtn" type="button">Move Artwork</button>
          </div>
        </div>

        <div class="adminRow">
          <button id="clearAllTilesBtn" type="button">Clear All Tiles</button>
        </div>

        <div class="adminRow">
          <button id="undoBtn" type="button" disabled>Undo</button>
        </div>

        <div class="adminRow">
          <button id="shuffleButton" type="button">Shuffle Tiles</button>
          <button id="undoShuffleBtn" type="button" disabled>Undo Shuffle</button>
          <button id="adminCloseBtn" type="button" aria-label="Close admin modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Undo Shuffle Confirmation Modal -->
  <div id="undoShuffleModal" class="modalOverlay hidden" role="dialog" aria-modal="true" aria-labelledby="undoShuffleModalTitle">
    <div class="modalCard" role="document">
      <h2 id="undoShuffleModalTitle">Undo last shuffle?</h2>

      <div class="modal-message">
        <p>This will restore tile placements to the state before the most recent shuffle.</p>
        <p>Any changes made after that shuffle will be overwritten.</p>
        <p><strong>Proceed?</strong></p>
      </div>

      <div class="upload-actions">
        <button id="undoShuffleCancelBtn" type="button">Cancel</button>
        <button id="undoShuffleProceedBtn" type="button">Proceed</button>
      </div>
    </div>
  </div>

  <!-- Move Override Confirmation Modal -->
  <div id="moveOverrideModal" class="modalOverlay hidden" role="dialog" aria-modal="true" aria-labelledby="moveOverrideModalTitle">
    <div class="modalCard" role="document">
      <h2 id="moveOverrideModalTitle">Confirm Rule Override</h2>

      <div class="modal-message">
        <p>This move breaks gallery rules.</p>
        <p>Artwork is being placed in a tile size it did not earn through upgrade or shuffle logic.</p>
        <p><strong>Proceed anyway?</strong></p>
      </div>

      <div class="upload-actions">
        <button id="moveOverrideCancelBtn" type="button">Cancel</button>
        <button id="moveOverrideProceedBtn" type="button">Proceed</button>
      </div>
    </div>
  </div>

  <!-- Admin Debug Footer (development only) -->
  <div id="adminDebugFooter" class="admin-debug-footer" style="display: none;"></div>

  <!-- JS -->
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
  <script src="{{ url_for('static', filename='vendor/cropper/cropper.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/upload_modal.js') }}"></script>
</body>
</html>
