<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Last Gallery</title>

  <!-- Main stylesheet -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-debug.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-tile-labels.css') }}">

  <!-- Cropper.js stylesheet -->
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/cropper/cropper.min.css') }}">

  <!-- Expose server state to JS (single source of truth) -->
  <script>
    window.SERVER_GRID_COLOR = "{{ grid_color|default('#b84c27') }}";
    // DISABLED: No longer inject demo placement data
    // Tiles start empty - artwork only comes from upload system database
    window.SERVER_PLACEMENT = {};
  </script>
</head>

<body>
  <!-- Top bar: title (left) + controls (right) -->
  <header class="controls">
    <div id="siteTitle">The Last Gallery</div>

    <div id="gridControls" role="group" aria-label="Gallery controls">
      <!-- Primary action -->
      <button id="addArtworkBtn" type="button">Add Your Artwork</button>

      <!-- Admin icon (opens PIN modal) -->
      <button id="adminBtn" class="iconBtn" type="button" aria-label="Admin">
        <!-- simple gear icon (inline SVG, no dependency) -->
        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
          <path d="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 0 0 .12-.64l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.1 7.1 0 0 0-1.63-.94l-.36-2.54A.5.5 0 0 0 13.9 1h-3.8a.5.5 0 0 0-.49.42l-.36 2.54c-.58.23-1.12.54-1.63.94l-2.39-.96a.5.5 0 0 0-.6.22L2.7 7.48a.5.5 0 0 0 .12.64l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94L2.82 14.52a.5.5 0 0 0-.12.64l1.92 3.32c.13.22.39.31.6.22l2.39-.96c.5.4 1.05.71 1.63.94l.36 2.54c.04.24.25.42.49.42h3.8c.24 0 .45-.18.49-.42l.36-2.54c.58-.23 1.12-.54 1.63-.94l2.39.96c.22.09.47 0 .6-.22l1.92-3.32a.5.5 0 0 0-.12-.64l-2.03-1.58ZM12 15.5A3.5 3.5 0 1 1 12 8a3.5 3.5 0 0 1 0 7.5Z"/>
        </svg>
      </button>
    </div>
  </header>

  <div id="simpleWelcome" class="simpleWelcome hidden" role="dialog" aria-modal="true" aria-label="Welcome">
    <div class="simpleWelcomeCard" role="document">
      <div class="simpleWelcomeTitle">Welcome to The Last Gallery</div>
      <div class="simpleWelcomeText">Tap "Enter Gallery" to continue.</div>
      <button id="simpleWelcomeEnterBtn" class="simpleWelcomeBtn" type="button">Enter Gallery</button>
    </div>
  </div>

  <!-- Grid Wrapper -->
  <div class="gallery-wall-wrapper">
    <div id="galleryWall" class="gallery-wall"></div>
  </div>

  <!-- Add Artwork modal (hidden by default) -->
  <div id="uploadModal" class="modalOverlay hidden" role="dialog" aria-modal="true" aria-labelledby="uploadModalTitle">
    <div class="modalCard" role="document">
      <h2 id="uploadModalTitle">Add Your Artwork</h2>

      <div class="upload-help">
        <p>Choose an image from your device. Supported formats: JPG, PNG.</p>
        <ul>
          <li><strong>Hint:</strong> You may upload images of any dimensions. For best results, images closer to square work best.</li>
          <li><strong>Hint:</strong> Use the cropping tool in the preview window below to select the best square portion of your image to fit the square gallery tile.<br>(Note: When the tile is clicked, your image will pop up full-size with no cropping.)</li>
        </ul>
      </div>

      <div class="upload-controls">
        <label for="uploadFile">Choose image</label>
        <input id="uploadFile" type="file" accept="image/png, image/jpeg">
      </div>

      <!-- Preview area -->
      <div class="previewBox" id="previewBox">
        <img id="previewImage" src="" alt="Preview" class="hidden">
      </div>

      <div class="upload-metadata">
        <label for="artworkName">Artwork Title</label>
        <input id="artworkName" type="text" placeholder="Untitled" maxlength="100">

        <label for="artistName">Artist Name</label>
        <input id="artistName" type="text" placeholder="Anonymous" maxlength="100">
      </div>

      <div class="upload-instructions">
        We will optimize your image to load faster in the gallery.
      </div>

      <div class="upload-actions">
        <button id="cancelUploadBtn" type="button">Cancel</button>
        <button id="uploadContinue" type="button" disabled>Continue</button>
      </div>
    </div>
  </div>

  <!-- Admin modal (PIN gated) -->
  <div id="adminModal" class="modalOverlay hidden" role="dialog" aria-modal="true" aria-labelledby="adminModalTitle">
    <div class="modalCard" role="document">
      <h2 id="adminModalTitle">Admin</h2>

      <!-- PIN gate -->
      <div id="adminPinGate">
        <p class="modalSubtext">Enter PIN to unlock admin controls.</p>

        <div class="pinRow">
          <input
            id="adminPinInput"
            type="password"
            inputmode="numeric"
            autocomplete="one-time-code"
            maxlength="4"
            aria-label="Admin PIN"
          >
          <button id="adminPinSubmit" type="button">Unlock</button>
        </div>

        <div id="adminPinError" class="pinError hidden" aria-live="polite"></div>
      </div>

      <!-- Admin controls (hidden until unlocked) -->
      <div id="adminControlsPanel" class="hidden">
        <!-- Status message -->
        <div id="adminStatus" class="adminStatus hidden" role="status" aria-live="polite"></div>

        <div class="adminRow">
          <label for="gridColorPicker">Wall Color</label>
          <input
            type="color"
            id="gridColorPicker"
            value="{{ grid_color|default('#b84c27') }}"
          >
        </div>

        <div class="adminRow">
          <label>
            <input type="checkbox" id="outlineToggle" checked>
            Show tile outlines
          </label>
        </div>

        <!-- Clear single tile -->
        <div class="adminSection">
          <h3>Clear Tile</h3>
          <div class="adminRow">
            <input
              type="text"
              id="adminClearTileIdInput"
              placeholder="Tile ID (e.g., X99)"
              maxlength="10"
            >
            <button id="clearTileBtn" type="button">Clear Tile</button>
          </div>
        </div>

        <!-- Move artwork -->
        <div class="adminSection">
          <h3>Move Artwork</h3>
          <div class="adminRow">
            <input
              type="text"
              id="adminMoveFromInput"
              placeholder="From: X99"
              maxlength="10"
            >
          </div>
          <div class="adminRow">
            <input
              type="text"
              id="adminMoveToInput"
              placeholder="To: X12"
              maxlength="10"
            >
          </div>
          <div class="adminRow">
            <button id="moveArtworkBtn" type="button">Move Artwork</button>
          </div>
        </div>

        <div class="adminRow">
          <button id="clearAllTilesBtn" type="button">Clear All Tiles</button>
        </div>

        <div class="adminRow">
          <button id="undoBtn" type="button" disabled>Undo</button>
        </div>

        <div class="adminRow">
          <button id="shuffleButton" type="button">Shuffle Tiles</button>
          <button id="undoShuffleBtn" type="button" disabled>Undo Shuffle</button>
        </div>

        <div class="adminRow">
          <label>
            <input type="checkbox" id="showTileLabelsToggle">
            Show Tile Labels
          </label>
        </div>
      </div>

      <div class="upload-actions">
        <button id="adminCloseBtn" type="button" aria-label="Close admin modal">Close</button>
      </div>
    </div>
  </div>

  <!-- Undo Shuffle Confirmation Modal -->
  <div id="undoShuffleModal" class="modalOverlay hidden" role="dialog" aria-modal="true" aria-labelledby="undoShuffleModalTitle">
    <div class="modalCard" role="document">
      <h2 id="undoShuffleModalTitle">Undo last shuffle?</h2>

      <div class="modal-message">
        <p>This will restore tile placements to the state before the most recent shuffle.</p>
        <p>Any changes made after that shuffle will be overwritten.</p>
        <p><strong>Proceed?</strong></p>
      </div>

      <div class="upload-actions">
        <button id="undoShuffleCancelBtn" type="button">Cancel</button>
        <button id="undoShuffleProceedBtn" type="button">Proceed</button>
      </div>
    </div>
  </div>

  <!-- Move Override Confirmation Modal -->
  <div id="moveOverrideModal" class="modalOverlay hidden" role="dialog" aria-modal="true" aria-labelledby="moveOverrideModalTitle">
    <div class="modalCard" role="document">
      <h2 id="moveOverrideModalTitle">Confirm Rule Override</h2>

      <div class="modal-message">
        <p>This move breaks gallery rules.</p>
        <p>Artwork is being placed in a tile size it did not earn through upgrade or shuffle logic.</p>
        <p><strong>Proceed anyway?</strong></p>
      </div>

      <div class="upload-actions">
        <button id="moveOverrideCancelBtn" type="button">Cancel</button>
        <button id="moveOverrideProceedBtn" type="button">Proceed</button>
      </div>
    </div>
  </div>

  <!-- Admin Debug Footer (development only) -->
  <div id="adminDebugFooter" class="admin-debug-footer" style="display: none;"></div>

  <!-- JS -->
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script src="{{ url_for('static', filename='vendor/cropper/cropper.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/upload_modal.js') }}"></script>
</body>
</html>
